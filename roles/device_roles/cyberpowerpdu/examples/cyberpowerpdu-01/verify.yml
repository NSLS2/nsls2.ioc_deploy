---
# Set to true to skip module compilation (for roles requiring proprietary SDKs)
skip_compilation: false

verification:
  files_must_exist:
    # Standard IOC boot files (created by deploy_ioc)
    - iocBoot/st.cmd
    - iocBoot/epicsEnv.cmd
    - iocBoot/postInit.cmd
    # Role-specific files
    - iocBoot/base.cmd
    - db/cyberPDU.template
    - db/cyberPDU_Outlet.template
    - db/cyberpdu.substitutions
    - db/cyberpdu_outlet.substitutions
    - mibs/CyberPower_MIB_v2.11.MIB
    - mibs/SNMPv2-SMI.txt
    - mibs/SNMPv2-TC[rfc2579].mib

  file_must_contain:
    iocBoot/st.cmd:
      - "iocInit"
    iocBoot/base.cmd:
      - "dbLoadDatabase"
      - "registerRecordDeviceDriver"
      - 'dbLoadTemplate("$(TOP)/db/cyberpdu.substitutions")'
      - 'dbLoadTemplate("$(TOP)/db/cyberpdu_outlet.substitutions")'
    db/cyberpdu_outlet.substitutions:
      - '1, "PDU Outlet 1", "127.0.0.1"'
      - '2, "PDU Outlet 2", "127.0.0.1"'
      - '3, "PDU Outlet 3", "127.0.0.1"'
      - '4, "PDU Outlet 4", "127.0.0.1"'
      - '5, "PDU Outlet 5", "127.0.0.1"'
      - '6, "PDU Outlet 6", "127.0.0.1"'
      - '7, "PDU Outlet 7", "127.0.0.1"'
      - '8, "PDU Outlet 8", "127.0.0.1"'

  file_must_not_contain:
    iocBoot/st.cmd:
      - "{{"  # No unrendered jinja
      - "}}"
    iocBoot/base.cmd:
      - "{{"
      - "}}"
    iocBoot/epicsEnv.cmd:
      - "{{"
      - "}}"
    db/cyberpdu.substitutions:
      - "{{"
      - "}}"
    db/cyberpdu_outlet.substitutions:
      - "{{"
      - "}}"

  permissions:
    iocBoot/st.cmd: "0775"
